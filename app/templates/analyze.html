{% extends "base.html" %}

{% block content %}
    <html lang="en">
		<head>
		  <meta charset="UTF-8"/>
		  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
		  <title>Test Metric</title>
		  <link rel="stylesheet" type="text/css" href="/static/analyze.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretty-checkbox@3.0/dist/pretty-checkbox.min.css">

		  <!-- <link  href="/static/age-groups.csv"> -->
		  <script src="https://d3js.org/d3.v4.min.js"></script>

		</head>
		<body>
			<!-- <div id="main">
				<div class="d3-tooltip"></div>
				<svg style="margin-left: 100px" width="960" height="500"></svg>
			</div> -->
			<div id='layout1'>
		      <div id='container1'>
		        <div class="d3-tooltip"></div>
				<svg style="margin-left: 100px" width="960" height="500"></svg>
		      	<span id="loading"> <div class="loader"></div>
		      </div>
		  </div>

      <div id="dvCheckBoxListControl" class="dvCheckBoxListControl" name="dvCheckBoxListControl"></div>
      <div style="height: 20px"></div>
      <button type="button" id="mybtn" style="margin-left: 100px;">Get Rating!</button>
      <div style="height: 20px"></div>
      <span id="result" style="margin-left: 100px;"></span>
      <div style="height: 20px" ></div>
		</body>
		<script src="/static/tagRatings.js" type="module"></script>
		<script src="/static/analyze.js" type="module"></script>
    <script type="text/javascript">

        function CreateCheckBoxList(checkboxlistItems) {
          var table = $('<table style="margin-left: 100px"></table>');
          var counter = 0;
          $(checkboxlistItems).each(function () {
              table.append($('<tr></tr>').append($('<td style="width: 140px"></td>').append($('<input>').attr({
                  type: 'checkbox', name: 'chklistitem', value: this[0].valueOf(), id: 'chklistitem' + counter, 'class': 'chkListItem'
              })).append(
              $('<label style="padding-left: 5px">').attr({
                  for: 'chklistitem' + counter++,
                  'class': 'state'
              }).text(this[0].valueOf()))).append($('<td style="width: 140px"></td>').append($('<input>').attr({
                  type: 'checkbox', name: 'chklistitem', value: this[1].valueOf(), id: 'chklistitem' + counter, 'class': 'chkListItem'
              })).append(
              $('<label style="padding-left: 5px">').attr({
                  for: 'chklistitem' + counter++,
                  'class': 'state'
              }).text(this[1].valueOf()))).append($('<td style="width: 140px"></td>').append($('<input>').attr({
                  type: 'checkbox', name: 'chklistitem', value: this[2].valueOf(), id: 'chklistitem' + counter, 'class': 'chkListItem'
              })).append(
              $('<label style="padding-left: 5px">').attr({
                  for: 'chklistitem' + counter++,
                  'class': 'state'
              }).text(this[2].valueOf())))
            );
          });

          $('#dvCheckBoxListControl').append(table);
        }

          function GetSelectedCheckBoxes() {
            var allVals = [];
            $('.chkListItem:checked').each(function () {
                allVals.push(this.value);
            });
            var dataaa = {"data":allVals}
            $.ajax({
              type:"POST",
              url:"/getRating",
              data: JSON.stringify(dataaa),
              contentType: 'application/json',
              success: function(res) {

                $('#result').text(String(JSON.parse(res)["result"]));
            }.bind(this),
            error: function(xhr, status, err) {
                console.error(xhr, status, err.toString());
            }.bind(this)
            });
          }

          $(document).ready(function() {
            $("#mybtn").click(function(){
                GetSelectedCheckBoxes();
            });
          });

         function autorun()
         {
          CreateCheckBoxList([['Wifi', 'Food', 'Service'],
           ['Timely', 'Price', 'Parking'],
           ['Valet', 'Cuisine', 'Ambience'],
           ['Night', 'Alcohol', 'Dessert'],
           ['Atmosphere', 'Staff', 'Hygiene'],
           ['Delivery', 'Seating', 'Spacious'],
           ['Lighting', 'Rooftop', 'Music'],
           ['Reservation', 'Birthday', 'Smoking'],
           ['Bar', 'Outdoor', 'Brewery'],
           ['Pet-friendly', 'Dance', 'Vegan-friendly']]);
         }

         if (document.addEventListener) document.addEventListener("DOMContentLoaded", autorun, false);
         else if (document.attachEvent) document.attachEvent("onreadystatechange", autorun);
         else window.onload = autorun;
    </script>
	</html>

{% endblock %}
